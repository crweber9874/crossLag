<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulating the consequences of unobserved confounding in the CLPM • crossLag</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Simulating the consequences of unobserved confounding in the CLPM">
<meta property="og:description" content="crossLag">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">crossLag</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/simulation.html">Simulating the consequences of unobserved confounding in the CLPM</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Simulating the consequences of unobserved
confounding in the CLPM</h1>
                        <h4 data-toc-skip class="author">Christopher
Weber</h4>
            
            <h4 data-toc-skip class="date">2024-08-05</h4>
      
      
      <div class="hidden name"><code>simulation.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="the-cross-lagged-regression-model">The Cross Lagged Regression Model<a class="anchor" aria-label="anchor" href="#the-cross-lagged-regression-model"></a>
</h2>
<p>It is difficult to sort out causal mechanisms with cross-sectional
observational data, panel and cross sectional. Causal relationships
require careful theorizing about the data generating process. Data,
particularly when observational, and statistical procedures do not
guarantee that researcher will identify a causal mechanism.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://haven.tidyverse.org" class="external-link">haven</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.dagitty.net" class="external-link">dagitty</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-causal/ggdag" class="external-link">ggdag</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Yet, it is not uncommon for researchers to use statistical techniques
to identify causal mechanisms, occasionally with very little theorizing
about the data generating process. One such statistical technique is the
cross-lagged panel model (CLPM). The CLPM is a variant of the
Autoregressive Distributed Lag model used in econometrics, and the
identified causal mechanism is a particular type of causality, Granger
Causality. The reasoning is both simple and elegant. The notion is that
if one measures <span class="math inline">\(x\)</span> at time <span class="math inline">\(t-1\)</span> and <span class="math inline">\(t\)</span>, and <span class="math inline">\(y\)</span> at time <span class="math inline">\(t-1\)</span> and <span class="math inline">\(t\)</span>, then one estimates a model that
predicts <span class="math inline">\(y_{t}\)</span> from <span class="math inline">\(x_{t-1}\)</span> and <span class="math inline">\(y_{t-1}\)</span>, and an additional model where
<span class="math inline">\(x_{t}\)</span> is predicted from <span class="math inline">\(y_{t-1}\)</span> and <span class="math inline">\(x_{t-1}\)</span>. The temporal ordering of the
data is then used to identify causal relationships. Although one may not
be able to manipulate <span class="math inline">\(x\)</span> and <span class="math inline">\(t\)</span> – to rule out spurious relationships –
if <span class="math inline">\(x\)</span> measured in the past predicts
<span class="math inline">\(y\)</span> in the present, but <span class="math inline">\(y\)</span> measured in the past doesn’t predict
<span class="math inline">\(x\)</span> in the present, one can be
reasonably certain that the causal ordering is such that <span class="math inline">\(x\)</span> affects <span class="math inline">\(y\)</span> and <span class="math inline">\(y\)</span> does not affect <span class="math inline">\(x\)</span>. Graphically, the model can be
represented as a Directed Acyclic Graph (DAG, Pearl 2001).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>repr.plot.width <span class="op">=</span> <span class="fl">2</span>, repr.plot.height <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>  <span class="co"># Set smaller plot size</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/dagitty.html" class="external-link">dagitty</a></span><span class="op">(</span><span class="st">"dag {</span></span>
<span><span class="st">    X1 -&gt; Y2 </span></span>
<span><span class="st">    Y1 -&gt; Y2</span></span>
<span><span class="st">    X1 -&gt; X2 </span></span>
<span><span class="st">    Y1 -&gt; X2</span></span>
<span><span class="st"></span></span>
<span><span class="st">}"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>U1<span class="op">=</span><span class="fl">0.5</span>, Y1<span class="op">=</span><span class="fl">1</span>,X1<span class="op">=</span><span class="fl">1</span>,Y2<span class="op">=</span><span class="fl">2</span>,X2<span class="op">=</span><span class="fl">2</span>, U2<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>    y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>U1<span class="op">=</span><span class="fl">1.5</span>, Y1<span class="op">=</span><span class="fl">1</span>,X1<span class="op">=</span><span class="fl">2</span>,Y2<span class="op">=</span><span class="fl">1</span>,X2<span class="op">=</span><span class="fl">2</span>, U2<span class="op">=</span><span class="fl">2.5</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://r-causal.github.io/ggdag/reference/ggdag.html" class="external-link">ggdag</a></span><span class="op">(</span><span class="va">g</span>, text <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-causal.github.io/ggdag/reference/theme_dag_blank.html" class="external-link">theme_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Figure 1: The Cross-Lagged Regression (CLR) Model"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-2-1.png" width="40%"></p>
<p>The CLPM is a variant of the Autoregressive Distributed Lag model
used in econometrics, and the causal mechanism identified is often
referred to as Granger Causality. Granger causality is a concept that
means that if <span class="math inline">\(x\)</span> measured at time
<span class="math inline">\(t-1\)</span> predicts <span class="math inline">\(y\)</span> at time <span class="math inline">\(t\)</span>, then <span class="math inline">\(x\)</span> Granger causes <span class="math inline">\(y\)</span>. The CLPM can be written as</p>
<span class="math display">\[\begin{eqnarray}
y_{t=2, i}=a_0 + a_1 y_{t=1, i} + a_2 x_{t=1, i} + e_{1,i} \hspace{1in}
(1)\\

x_{t=2, i}=b_0 + b_1 y_{t=1, i} + b_2 x_{t=1, i} + e_{2,i} \hspace{1in}
(2)\\
\end{eqnarray}\]</span>
<p>The conclusions from the CLPM attempts to leverage the temporal order
in which variables are observed. If one were to estimate these two
equations using traditional regression techniques, a large <span class="math inline">\(a_2\)</span> coefficient represents a causal
relationship from <span class="math inline">\(x_1\rightarrow
y_2\)</span>; whereas a large <span class="math inline">\(b_2\)</span>
coefficient translates to reversed effect, i.e., <span class="math inline">\(y_1 \rightarrow x_2\)</span>. If <span class="math inline">\(a_2\)</span> is large and <span class="math inline">\(b_2\)</span> is effectively zero, it is tempting
to conclude that <span class="math inline">\(x\)</span> causes <span class="math inline">\(y\)</span> but <span class="math inline">\(y\)</span> does not cause <span class="math inline">\(x\)</span>. In both cases, we include the lagged
value of the dependent variable, <span class="math inline">\(y_{t-1,
i}\)</span> and <span class="math inline">\(x_{t-1, i}\)</span>, to
control for the effect of the dependent variable; each unit serves as
their own control, or baseline. Should <span class="math inline">\(a_2\)</span> or <span class="math inline">\(b_2\)</span> reach conventional levels of
statistical significance, it is tempting to conclude that a causal
effect has been identified. Economists refer to this as Granger
Causality, which is a statistical test of whether the lagged value of
the independent variable can predict the dependent variable after
controlling for the lagged value of the dependent variable.</p>
<p>While the reasoning is simple, rather strong assumptions about the
data generating process must be made.. There several issues that arise
upon estimating this model. The first pertains to the empirical
consequence of including a lagged realization of the independent
variable in the regression model, rather than contemporaneous effects;
the the second issue pertains to inclusion of a lagged dependent
variable (Allison 1990); and the third revolves around the
identification of causal effects, particularly when there are unobserved
confounders and stable unit effects.</p>
</div>
<div class="section level2">
<h2 id="contemporaneous-and-lagged-effects">Contemporaneous and Lagged Effects<a class="anchor" aria-label="anchor" href="#contemporaneous-and-lagged-effects"></a>
</h2>
<p>A notoriously difficult issue with observational cross-section data
is the identification of causal effects. The conditional effect of <span class="math inline">\(x\)</span> on <span class="math inline">\(y\)</span> <span class="math inline">\(x
\rightarrow y\)</span> even in the most carefully specified model, using
sophisticated regression techniques will rarely allow one to rule out
the possibility that an effect is spurious. This is because the
researcher cannot control for all possible confounders.</p>
<p>It is tempting to draw upon panel data in these circumstances. The
researcher may then include a lag of the indepedendent variable,
empirically sidestepping the thorny issue of trying to identify the
contemporaneous effect of <span class="math inline">\(x\)</span> on
<span class="math inline">\(y\)</span>. While the
<strong>contemporaneous causal</strong> effect cannot be reliably
estimated because it is likely confounded by unobservable variables. It
is tempting to leverage the temporal nature of the data to estimate a
lagged causal effect in place of the contemporaneous causal effect.</p>
<p>Such reasoning is relatively commom in the social sciences, dating
back to the pioneering work of Campbell (1963) as well as Campbell and
Stanley (1963). The publication of Finkel’s (1995) Sage monograph
further popularized the technique. It is commonly used and referenced in
empirical work, including that of the authors of this paper, on more
than one occasion. For instance, Weber and Federico examine how
authoritarianism stems from anxious and avoidant psychological
attachment patterns. In defense of their findings, they write:</p>
<blockquote>
<p>Although we assume that general psychological orientations like
anxiety and avoidance should be causally prior to worldviews and
ideology—like other researchers in this area (e.g., Jost et al.,
2003)—longitudinal data would provide a less-ambiguous pattern of
support for this assumption. For example, panel data on all relevant
constructs would allow us to examine the strength of competing causal
patterns using a cross-lagged design (Finkel, 1995). Similarly, actual
developmental data might allow us to see whether attachment patterns
early in life are predictive of different worldviews and ideologies
later on.</p>
</blockquote>
<p>Yet, Bellamare et al (2017) notes that a lagged realization of the
independent variable does not necessarily improve one’s ability to
identify a causal effect. Instead, it sidesteps the problem, moving from
the identification of a contemporaneous causal effect to identifying a
lagged causal effect. Unfortunately, the ordering of observations does
not immediately improve one’s ability to identify a causal relationship,
except in restrictive circumstances.</p>
<p>In particular, focusing on the lag of x moves the problem to
identifying a lagged causal effect, effectively ignoring causal
mechanisms that operate contemporaneously. This can be theoretically or
empirically problematic. Theoretically, it is difficult to defend the
notion that only a lagged, rather than contemporary, realization of the
independent variable causally flows to the dependent variable.
Empirically, failing to include contemporaneous independent variables in
equations 1 and 2 will distort the estimated effect of the lagged
independent variable on the dependent variable. The regression model may
be be misspeficied, and the estimated coefficients subsequently
biased.</p>
<p>Likewise, the inclusion of a lagged dependent variable is also
problematic, for reasons well-documented in the literature (see Allison
1990). Introductory statistics textbooks present it in the context of
autocorrelation, whereby including a lagged realization of the dependent
variable will correlate with the error terms in equations (1) and (2),
subsequently biasing parameter estimates and standard errors.</p>
<div class="section level3">
<h3 id="the-dag">The DAG<a class="anchor" aria-label="anchor" href="#the-dag"></a>
</h3>
<p>Identitying causal effects with observational data is difficult due
to the presence of confounding variables. The problem is not limited to
cross-sectional data, and also apply to observational panel data (though
occasionally for different reasons). Consider the causal diagram in
Figure 2, a slight modification on the CLR model presented in Figure 1.
In this case, we have added a confounder set <span class="math inline">\(U\)</span> that is correlated with both <span class="math inline">\(x_1\)</span> and <span class="math inline">\(y_1\)</span>, as well as <span class="math inline">\(x_2\)</span> and <span class="math inline">\(y_2\)</span>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/dagitty.html" class="external-link">dagitty</a></span><span class="op">(</span><span class="st">"dag {</span></span>
<span><span class="st">    X1 -&gt; Y2 </span></span>
<span><span class="st">    Y1 -&gt; Y2</span></span>
<span><span class="st">    X1 -&gt; X2 </span></span>
<span><span class="st">    Y1 -&gt; X2</span></span>
<span><span class="st">    U -&gt; X1</span></span>
<span><span class="st">    U -&gt; Y1</span></span>
<span><span class="st">    U -&gt; X2</span></span>
<span><span class="st">    U -&gt; Y2</span></span>
<span><span class="st">    U &lt;-&gt; U</span></span>
<span><span class="st">}"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> Y1<span class="op">=</span><span class="fl">1</span>,X1<span class="op">=</span><span class="fl">1</span>,Y2<span class="op">=</span><span class="fl">2</span>,X2<span class="op">=</span><span class="fl">2</span>, U<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span>,</span>
<span>    y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> Y1<span class="op">=</span><span class="fl">1</span>,X1<span class="op">=</span><span class="fl">2</span>,Y2<span class="op">=</span><span class="fl">1</span>,X2<span class="op">=</span><span class="fl">2</span>, U<span class="op">=</span><span class="fl">2.4</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://r-causal.github.io/ggdag/reference/ggdag.html" class="external-link">ggdag</a></span><span class="op">(</span><span class="va">g</span>, text <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-causal.github.io/ggdag/reference/theme_dag_blank.html" class="external-link">theme_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Figure 2: The Cross-Lagged Regression (CLR) Model.\nConfounding by U"</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-3-1.png" width="40%"></p>
<p>In this case, the confounder set creates a “backdoor path” from U to
<span class="math inline">\(x_2\)</span> and <span class="math inline">\(y_2\)</span> through <span class="math inline">\(x_1\)</span> and <span class="math inline">\(y_1\)</span>. Ignoring the confounder set <span class="math inline">\(U\)</span> will bias the estimates of the
coefficients estimated in the model; this is the notion of “spurious
regression” whereby we may even estimate a relationship when none
exist.The solution advocated in most textbooks is to include the
confounder set <span class="math inline">\(U\)</span> in one’s
regression model. This is also known as “back-door adjustment” as we
condition on this confounder set blocking any paths that run through
<span class="math inline">\(U\)</span>. This is reason researchers often
include a set of control variables, occasionally an unwieldy set, a
“kitchen sink” of numerous variables that may or may not be controls
(King, 20??).</p>
<p>The figure below demonstrates that including the confounder set <span class="math inline">\(U\)</span> blocks the backdoor path from <span class="math inline">\(x_2\)</span> to <span class="math inline">\(y_2\)</span> through <span class="math inline">\(x_1\)</span> and <span class="math inline">\(y_1\)</span>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-causal.github.io/ggdag/reference/adjustment_sets.html" class="external-link">ggdag_adjustment_set</a></span><span class="op">(</span><span class="va">g</span>, exposure <span class="op">=</span> <span class="st">"Y1"</span>, outcome <span class="op">=</span> <span class="st">"Y2"</span>, shadow <span class="op">=</span> <span class="st">"TRUE"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-causal.github.io/ggdag/reference/theme_dag_blank.html" class="external-link">theme_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Figure 3: We need to condition on:"</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-4-1.png" width="40%"></p>
<p>What if – in addition to the counfounder set – there exists
contemporaneous effects, such as, <span class="math inline">\(x_1\)</span> <span class="math inline">\(y_2\)</span> and <span class="math inline">\(x_2\)</span> <span class="math inline">\(y_2\)</span>? Now the causal diagram becomes:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/dagitty.html" class="external-link">dagitty</a></span><span class="op">(</span><span class="st">"dag {</span></span>
<span><span class="st">    X1 -&gt; Y2 </span></span>
<span><span class="st">    X2 -&gt; Y2 </span></span>
<span><span class="st">    Y1 -&gt; Y2</span></span>
<span><span class="st">    X1 -&gt; X2 </span></span>
<span><span class="st">    Y1 -&gt; X2</span></span>
<span><span class="st">    U -&gt; Y1</span></span>
<span><span class="st">    U -&gt; Y2</span></span>
<span><span class="st">    X1 -&gt; Y1</span></span>
<span><span class="st">}"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> Y1<span class="op">=</span><span class="fl">1</span>,X1<span class="op">=</span><span class="fl">1</span>,Y2<span class="op">=</span><span class="fl">2</span>,X2<span class="op">=</span><span class="fl">2</span>, U<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span>,</span>
<span>    y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> Y1<span class="op">=</span><span class="fl">1</span>,X1<span class="op">=</span><span class="fl">2</span>,Y2<span class="op">=</span><span class="fl">1</span>,X2<span class="op">=</span><span class="fl">2</span>, U<span class="op">=</span><span class="fl">2.4</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://r-causal.github.io/ggdag/reference/ggdag.html" class="external-link">ggdag</a></span><span class="op">(</span><span class="va">g</span>, text <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-causal.github.io/ggdag/reference/theme_dag_blank.html" class="external-link">theme_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Figure 4: The Cross-Lagged Regression (CLR) Model.\nContemporaneous Causal Effect"</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-5-1.png" width="40%"></p>
<p>The presence of these contemporaneous effects poses a problem for two
reasons. First, <span class="math inline">\(x_1 \rightarrow x_2
\rightarrow y_2\)</span>, where <span class="math inline">\(x_2\)</span>
mediates the effect of <span class="math inline">\(x_1\)</span> on <span class="math inline">\(y_2\)</span>. What is more, <span class="math inline">\(y_1\)</span> also serves a mediator for this
effect. These effects are omitted from the CLPM as specified above.
However, if such a relationship exists, including <span class="math inline">\(y_1\)</span> – the lag of y, which we have done
above – is also problematic. The reason is that <span class="math inline">\(y_1\)</span> is a “collider.” Conditioning on
<span class="math inline">\(y_1\)</span> – the lag – will open several
backdoor paths that will bias the estimated coefficients. In. this case,
<span class="math inline">\(y_1\)</span> opens up backdoor paths whereby
the effect of <span class="math inline">\(y_1\)</span> represents a
potentially true effect plus indirect paths where the independent
variable and the unobserved confounder affects <span class="math inline">\(y_2\)</span>. Because of this “collider bias”
(Pearl 2001), one might be better served by excluding <span class="math inline">\(y_1\)</span> from the estimated equation, adopting
a simpler model, <span class="math inline">\(y_2 = \beta_1 x_1 +
\epsilon\)</span>.</p>
</div>
</div>
<div class="section level2">
<h2 id="simulate-data">Simulate Data<a class="anchor" aria-label="anchor" href="#simulate-data"></a>
</h2>
<span class="math display">\[\begin{eqnarray}
E(Y^{X1=1} - Y^{X1=0} ) = E_{Z, U} [E(Y|X1=0, Z, U) - [E(Y|X1=0, Z, U)]
= c_2\\
&amp; E_{Z} [E(Y|X1=0, Z) - [E(Y|X1=0, Z)] = c_2 + \\
\end{eqnarray}\]</span>
<p>to examine some of this, let’s simulated some data, using the package
“CrossLag” – which includes a simulation function
“simulate_observed_clr.”</p>
<ul>
<li>
<em>simulate_observed_clr</em>: Simulate data for a cross-lagged
panel model</li>
<li>Vary cross lag, stability, waves, and contemporaneous effects</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"crweber9874/crossLag"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Using GitHub PAT from the git credential store.</span></span></code></pre>
<pre><code><span><span class="co">## Downloading GitHub repo crweber9874/crossLag@HEAD</span></span></code></pre>
<pre><code><span><span class="co">## Skipping 5 packages ahead of CRAN: loo, StanHeaders, bayesplot, rstantools, rstan</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="color: #00BBBB;">R CMD build</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## * checking for file ‘/private/var/folders/rm/lnnn06ss2_j0ngxtflkxvf5w0000gt/T/RtmpnXS8xZ/remotesceec7f7e3756/crweber9874-crossLag-0f96589/DESCRIPTION’ ... OK</span></span>
<span><span class="co">## * preparing ‘crossLag’:</span></span>
<span><span class="co">## * checking DESCRIPTION meta-information ... OK</span></span>
<span><span class="co">## * checking for LF line-endings in source and make files and shell scripts</span></span>
<span><span class="co">## * checking for empty or unneeded directories</span></span>
<span><span class="co">## Omitted ‘LazyData’ from DESCRIPTION</span></span>
<span><span class="co">## * building ‘crossLag_0.1.0.tar.gz’</span></span></code></pre>
<pre><code><span><span class="co">## Installing package into '/private/var/folders/rm/lnnn06ss2_j0ngxtflkxvf5w0000gt/T/Rtmphi0JN5/temp_libpathc5ea5a0c846a'</span></span>
<span><span class="co">## (as 'lib' is unspecified)</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lavaan.ugent.be" class="external-link">lavaan</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: package 'lavaan' was built under R version 4.3.3</span></span></code></pre>
<pre><code><span><span class="co">## This is lavaan 0.6-18</span></span>
<span><span class="co">## lavaan is FREE software! Please report any bugs.</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">crossLag</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/simulate_observed_clr.html">simulate_observed_clr</a></span><span class="op">(</span>waves <span class="op">=</span> <span class="fl">2</span>, sample.nobs <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                      stability.x <span class="op">=</span> <span class="fl">0.75</span>, stability.y <span class="op">=</span> <span class="fl">0.75</span>, </span>
<span>                      contemporaneous.x <span class="op">=</span> <span class="fl">0.5</span>, cross.x <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>                      beta.z <span class="op">=</span> <span class="fl">0.5</span>, beta.u <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>                      var.y <span class="op">=</span> <span class="fl">1</span>, var.x <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                      cov.xy <span class="op">=</span> <span class="fl">0.5</span>, cov.uz <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $model</span></span>
<span><span class="co">## [1] "\n    u ~~ 0.5*z\n\n    # Regression equations for the first wave\n    x1 ~ 0.5*u + 0.5*z\n    y1 ~ 0.5*u + 0.5*z + 0.5*x1\n                         \n            x2 ~ 0.5*u +0.5*z + 0.75*x1\n            y2 ~ 0.5*u +0.5*z + 0.5*x2+0.5*x1+0.75*y1\n        x1 ~~ 1*x1\n        y1 ~~ 1*y1\n        \n        x2 ~~ 1*x2\n        y2 ~~ 1*y2\n        \n        x1 ~~ 0.5* y1\n        \n        x2 ~~ 0.5* y2\n        "</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $data</span></span>
<span><span class="co">##           x1        y1        x2        y2          u         z</span></span>
<span><span class="co">## 1 1.02609740  2.121664 2.0483969  3.129582  0.2918971  0.194452</span></span>
<span><span class="co">## 2 0.05438709 -2.160433 0.2798383 -1.700321 -0.3292720 -1.265119</span></span></code></pre>
<p>The function returns a list, the first element is the lavaan model
syntax used to generate the data. The second is the data itself. This
allows us to make necessary modifications to the model, which can be
applied to the data.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_observed_clr.html">simulate_observed_clr</a></span><span class="op">(</span>waves <span class="op">=</span> <span class="fl">3</span>, sample.nobs <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="co"># Fit lavaan model</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/sem.html" class="external-link">sem</a></span><span class="op">(</span><span class="va">example_data</span><span class="op">$</span><span class="va">model</span>, data <span class="op">=</span> <span class="va">example_data</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span>, fit.measures<span class="op">=</span><span class="cn">TRUE</span>, standardized<span class="op">=</span><span class="cn">TRUE</span>, rsquare<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## lavaan 0.6-18 ended normally after 10 iterations</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Estimator                                         ML</span></span>
<span><span class="co">##   Optimization method                           NLMINB</span></span>
<span><span class="co">##   Number of model parameters                         2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Number of observations                           100</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model Test User Model:</span></span>
<span><span class="co">##                                                       </span></span>
<span><span class="co">##   Test statistic                                23.984</span></span>
<span><span class="co">##   Degrees of freedom                                34</span></span>
<span><span class="co">##   P-value (Chi-square)                           0.899</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model Test Baseline Model:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Test statistic                              1153.499</span></span>
<span><span class="co">##   Degrees of freedom                                28</span></span>
<span><span class="co">##   P-value                                        0.000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## User Model versus Baseline Model:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Comparative Fit Index (CFI)                    1.000</span></span>
<span><span class="co">##   Tucker-Lewis Index (TLI)                       1.007</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Loglikelihood and Information Criteria:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Loglikelihood user model (H0)              -1092.362</span></span>
<span><span class="co">##   Loglikelihood unrestricted model (H1)      -1080.370</span></span>
<span><span class="co">##                                                       </span></span>
<span><span class="co">##   Akaike (AIC)                                2188.724</span></span>
<span><span class="co">##   Bayesian (BIC)                              2193.935</span></span>
<span><span class="co">##   Sample-size adjusted Bayesian (SABIC)       2187.618</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Root Mean Square Error of Approximation:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   RMSEA                                          0.000</span></span>
<span><span class="co">##   90 Percent confidence interval - lower         0.000</span></span>
<span><span class="co">##   90 Percent confidence interval - upper         0.032</span></span>
<span><span class="co">##   P-value H_0: RMSEA &lt;= 0.050                    0.982</span></span>
<span><span class="co">##   P-value H_0: RMSEA &gt;= 0.080                    0.001</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Standardized Root Mean Square Residual:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   SRMR                                           0.097</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parameter Estimates:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Standard errors                             Standard</span></span>
<span><span class="co">##   Information                                 Expected</span></span>
<span><span class="co">##   Information saturated (h1) model          Structured</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Regressions:</span></span>
<span><span class="co">##                    Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all</span></span>
<span><span class="co">##   x1 ~                                                                  </span></span>
<span><span class="co">##     u                 0.500                               0.500    0.449</span></span>
<span><span class="co">##     z                 0.500                               0.500    0.403</span></span>
<span><span class="co">##   y1 ~                                                                  </span></span>
<span><span class="co">##     u                 0.500                               0.500    0.323</span></span>
<span><span class="co">##     z                 0.500                               0.500    0.290</span></span>
<span><span class="co">##     x1                0.500                               0.500    0.360</span></span>
<span><span class="co">##   x2 ~                                                                  </span></span>
<span><span class="co">##     u                 0.500                               0.500    0.286</span></span>
<span><span class="co">##     z                 0.500                               0.500    0.257</span></span>
<span><span class="co">##     x1                0.900                               0.900    0.573</span></span>
<span><span class="co">##   y2 ~                                                                  </span></span>
<span><span class="co">##     u                 0.500                               0.500    0.159</span></span>
<span><span class="co">##     z                 0.500                               0.500    0.143</span></span>
<span><span class="co">##     x2                0.500                               0.500    0.278</span></span>
<span><span class="co">##     x1                0.300                               0.300    0.106</span></span>
<span><span class="co">##     y1                0.900                               0.900    0.444</span></span>
<span><span class="co">##   x3 ~                                                                  </span></span>
<span><span class="co">##     u                 0.500                               0.500    0.218</span></span>
<span><span class="co">##     z                 0.500                               0.500    0.196</span></span>
<span><span class="co">##     x2                0.900                               0.900    0.686</span></span>
<span><span class="co">##   y3 ~                                                                  </span></span>
<span><span class="co">##     u                 0.500                               0.500    0.099</span></span>
<span><span class="co">##     z                 0.500                               0.500    0.089</span></span>
<span><span class="co">##     x3                0.500                               0.500    0.228</span></span>
<span><span class="co">##     x2                0.300                               0.300    0.104</span></span>
<span><span class="co">##     y2                0.900                               0.900    0.563</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Covariances:</span></span>
<span><span class="co">##                    Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all</span></span>
<span><span class="co">##   u ~~                                                                  </span></span>
<span><span class="co">##     z                 0.000                               0.000    0.000</span></span>
<span><span class="co">##  .x1 ~~                                                                 </span></span>
<span><span class="co">##    .y1                0.500                               0.500    0.500</span></span>
<span><span class="co">##  .x2 ~~                                                                 </span></span>
<span><span class="co">##    .y2                0.500                               0.500    0.500</span></span>
<span><span class="co">##  .x3 ~~                                                                 </span></span>
<span><span class="co">##    .y3                0.500                               0.500    0.500</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Variances:</span></span>
<span><span class="co">##                    Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all</span></span>
<span><span class="co">##    .x1                1.000                               1.000    0.636</span></span>
<span><span class="co">##    .y1                1.000                               1.000    0.329</span></span>
<span><span class="co">##    .x2                1.000                               1.000    0.258</span></span>
<span><span class="co">##    .y2                1.000                               1.000    0.080</span></span>
<span><span class="co">##    .x3                1.000                               1.000    0.150</span></span>
<span><span class="co">##    .y3                1.000                               1.000    0.031</span></span>
<span><span class="co">##     u                 1.266    0.179    7.071    0.000    1.266    1.000</span></span>
<span><span class="co">##     z                 1.022    0.145    7.071    0.000    1.022    1.000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## R-Square:</span></span>
<span><span class="co">##                    Estimate</span></span>
<span><span class="co">##     x1                0.364</span></span>
<span><span class="co">##     y1                0.671</span></span>
<span><span class="co">##     x2                0.742</span></span>
<span><span class="co">##     y2                0.920</span></span>
<span><span class="co">##     x3                0.850</span></span>
<span><span class="co">##     y3                0.969</span></span></code></pre>
<p>Let’s start by simulating a 2 wave panel with 100 observations. Vary
the following :</p>
<ul>
<li>The effect of the unobserved confounder on the observed variables.
[-0.8, 0.8]</li>
</ul>
</div>
<div class="section level2">
<h2 id="ri-clpm">RI-CLPM<a class="anchor" aria-label="anchor" href="#ri-clpm"></a>
</h2>
<p>Let’s reshape the data from wide to long, using reshapeLong from the
package. This is useful to structure the simulated data.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate_observed_clr.html">simulate_observed_clr</a></span><span class="op">(</span>waves <span class="op">=</span> <span class="fl">5</span>, </span>
<span>                      sample.nobs <span class="op">=</span> <span class="fl">1000</span>, </span>
<span>                      stability.x <span class="op">=</span> <span class="fl">0.90</span>, </span>
<span>                      stability.y <span class="op">=</span> <span class="fl">0.90</span>, </span>
<span>                      contemporaneous.x <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                      cross.x <span class="op">=</span> <span class="fl">0.15</span>, </span>
<span>                      beta.z <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                      beta.u <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>                      var.y <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                      var.x <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                      cov.xy <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>                      cov.uz <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">$</span><span class="va">data</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate lmer</span></span>
<span><span class="va">dat_long</span> <span class="op">=</span> <span class="fu"><a href="../reference/reshape_long_sim_cr.html">reshape_long_sim_cr</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat_long</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">##      id  wave      x       y   xlag   ylag</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1     1  0.739 -<span style="color: #BB0000;">0.313</span>  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     1     2 -<span style="color: #BB0000;">0.344</span> -<span style="color: #BB0000;">1.12</span>    0.739 -<span style="color: #BB0000;">0.313</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>     1     3 -<span style="color: #BB0000;">0.287</span> -<span style="color: #BB0000;">0.993</span>  -<span style="color: #BB0000;">0.344</span> -<span style="color: #BB0000;">1.12</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>     1     4 -<span style="color: #BB0000;">1.63</span>  -<span style="color: #BB0000;">2.88</span>   -<span style="color: #BB0000;">0.287</span> -<span style="color: #BB0000;">0.993</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>     1     5 -<span style="color: #BB0000;">2.34</span>  -<span style="color: #BB0000;">3.03</span>   -<span style="color: #BB0000;">1.63</span>  -<span style="color: #BB0000;">2.88</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>     2     1 -<span style="color: #BB0000;">1.51</span>   0.073<span style="text-decoration: underline;">1</span> <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit the brms model</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: Rcpp</span></span></code></pre>
<pre><code><span><span class="co">## Warning: package 'Rcpp' was built under R version 4.3.3</span></span></code></pre>
<pre><code><span><span class="co">## Loading 'brms' package (version 2.21.6). Useful instructions</span></span>
<span><span class="co">## can be found by typing help('brms'). A more detailed introduction</span></span>
<span><span class="co">## to the package is available through vignette('brms_overview').</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'brms'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     ar</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span>  <span class="va">xlag</span> <span class="op">+</span> <span class="va">ylag</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">id</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat_long</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Rows containing NAs were excluded from the model.</span></span></code></pre>
<pre><code><span><span class="co">## Compiling Stan program...</span></span></code></pre>
<pre><code><span><span class="co">## Start sampling</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).</span></span>
<span><span class="co">## Chain 1: </span></span>
<span><span class="co">## Chain 1: Gradient evaluation took 0.000212 seconds</span></span>
<span><span class="co">## Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 2.12 seconds.</span></span>
<span><span class="co">## Chain 1: Adjust your expectations accordingly!</span></span>
<span><span class="co">## Chain 1: </span></span>
<span><span class="co">## Chain 1: </span></span>
<span><span class="co">## Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)</span></span>
<span><span class="co">## Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)</span></span>
<span><span class="co">## Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)</span></span>
<span><span class="co">## Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)</span></span>
<span><span class="co">## Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)</span></span>
<span><span class="co">## Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)</span></span>
<span><span class="co">## Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)</span></span>
<span><span class="co">## Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)</span></span>
<span><span class="co">## Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)</span></span>
<span><span class="co">## Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)</span></span>
<span><span class="co">## Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)</span></span>
<span><span class="co">## Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)</span></span>
<span><span class="co">## Chain 1: </span></span>
<span><span class="co">## Chain 1:  Elapsed Time: 7.53 seconds (Warm-up)</span></span>
<span><span class="co">## Chain 1:                2.784 seconds (Sampling)</span></span>
<span><span class="co">## Chain 1:                10.314 seconds (Total)</span></span>
<span><span class="co">## Chain 1: </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).</span></span>
<span><span class="co">## Chain 2: </span></span>
<span><span class="co">## Chain 2: Gradient evaluation took 9.1e-05 seconds</span></span>
<span><span class="co">## Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.91 seconds.</span></span>
<span><span class="co">## Chain 2: Adjust your expectations accordingly!</span></span>
<span><span class="co">## Chain 2: </span></span>
<span><span class="co">## Chain 2: </span></span>
<span><span class="co">## Chain 2: Iteration:    1 / 2000 [  0%]  (Warmup)</span></span>
<span><span class="co">## Chain 2: Iteration:  200 / 2000 [ 10%]  (Warmup)</span></span>
<span><span class="co">## Chain 2: Iteration:  400 / 2000 [ 20%]  (Warmup)</span></span>
<span><span class="co">## Chain 2: Iteration:  600 / 2000 [ 30%]  (Warmup)</span></span>
<span><span class="co">## Chain 2: Iteration:  800 / 2000 [ 40%]  (Warmup)</span></span>
<span><span class="co">## Chain 2: Iteration: 1000 / 2000 [ 50%]  (Warmup)</span></span>
<span><span class="co">## Chain 2: Iteration: 1001 / 2000 [ 50%]  (Sampling)</span></span>
<span><span class="co">## Chain 2: Iteration: 1200 / 2000 [ 60%]  (Sampling)</span></span>
<span><span class="co">## Chain 2: Iteration: 1400 / 2000 [ 70%]  (Sampling)</span></span>
<span><span class="co">## Chain 2: Iteration: 1600 / 2000 [ 80%]  (Sampling)</span></span>
<span><span class="co">## Chain 2: Iteration: 1800 / 2000 [ 90%]  (Sampling)</span></span>
<span><span class="co">## Chain 2: Iteration: 2000 / 2000 [100%]  (Sampling)</span></span>
<span><span class="co">## Chain 2: </span></span>
<span><span class="co">## Chain 2:  Elapsed Time: 7.449 seconds (Warm-up)</span></span>
<span><span class="co">## Chain 2:                2.876 seconds (Sampling)</span></span>
<span><span class="co">## Chain 2:                10.325 seconds (Total)</span></span>
<span><span class="co">## Chain 2: </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 3).</span></span>
<span><span class="co">## Chain 3: </span></span>
<span><span class="co">## Chain 3: Gradient evaluation took 8.4e-05 seconds</span></span>
<span><span class="co">## Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.84 seconds.</span></span>
<span><span class="co">## Chain 3: Adjust your expectations accordingly!</span></span>
<span><span class="co">## Chain 3: </span></span>
<span><span class="co">## Chain 3: </span></span>
<span><span class="co">## Chain 3: Iteration:    1 / 2000 [  0%]  (Warmup)</span></span>
<span><span class="co">## Chain 3: Iteration:  200 / 2000 [ 10%]  (Warmup)</span></span>
<span><span class="co">## Chain 3: Iteration:  400 / 2000 [ 20%]  (Warmup)</span></span>
<span><span class="co">## Chain 3: Iteration:  600 / 2000 [ 30%]  (Warmup)</span></span>
<span><span class="co">## Chain 3: Iteration:  800 / 2000 [ 40%]  (Warmup)</span></span>
<span><span class="co">## Chain 3: Iteration: 1000 / 2000 [ 50%]  (Warmup)</span></span>
<span><span class="co">## Chain 3: Iteration: 1001 / 2000 [ 50%]  (Sampling)</span></span>
<span><span class="co">## Chain 3: Iteration: 1200 / 2000 [ 60%]  (Sampling)</span></span>
<span><span class="co">## Chain 3: Iteration: 1400 / 2000 [ 70%]  (Sampling)</span></span>
<span><span class="co">## Chain 3: Iteration: 1600 / 2000 [ 80%]  (Sampling)</span></span>
<span><span class="co">## Chain 3: Iteration: 1800 / 2000 [ 90%]  (Sampling)</span></span>
<span><span class="co">## Chain 3: Iteration: 2000 / 2000 [100%]  (Sampling)</span></span>
<span><span class="co">## Chain 3: </span></span>
<span><span class="co">## Chain 3:  Elapsed Time: 7.232 seconds (Warm-up)</span></span>
<span><span class="co">## Chain 3:                2.797 seconds (Sampling)</span></span>
<span><span class="co">## Chain 3:                10.029 seconds (Total)</span></span>
<span><span class="co">## Chain 3: </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 4).</span></span>
<span><span class="co">## Chain 4: </span></span>
<span><span class="co">## Chain 4: Gradient evaluation took 9.5e-05 seconds</span></span>
<span><span class="co">## Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.95 seconds.</span></span>
<span><span class="co">## Chain 4: Adjust your expectations accordingly!</span></span>
<span><span class="co">## Chain 4: </span></span>
<span><span class="co">## Chain 4: </span></span>
<span><span class="co">## Chain 4: Iteration:    1 / 2000 [  0%]  (Warmup)</span></span>
<span><span class="co">## Chain 4: Iteration:  200 / 2000 [ 10%]  (Warmup)</span></span>
<span><span class="co">## Chain 4: Iteration:  400 / 2000 [ 20%]  (Warmup)</span></span>
<span><span class="co">## Chain 4: Iteration:  600 / 2000 [ 30%]  (Warmup)</span></span>
<span><span class="co">## Chain 4: Iteration:  800 / 2000 [ 40%]  (Warmup)</span></span>
<span><span class="co">## Chain 4: Iteration: 1000 / 2000 [ 50%]  (Warmup)</span></span>
<span><span class="co">## Chain 4: Iteration: 1001 / 2000 [ 50%]  (Sampling)</span></span>
<span><span class="co">## Chain 4: Iteration: 1200 / 2000 [ 60%]  (Sampling)</span></span>
<span><span class="co">## Chain 4: Iteration: 1400 / 2000 [ 70%]  (Sampling)</span></span>
<span><span class="co">## Chain 4: Iteration: 1600 / 2000 [ 80%]  (Sampling)</span></span>
<span><span class="co">## Chain 4: Iteration: 1800 / 2000 [ 90%]  (Sampling)</span></span>
<span><span class="co">## Chain 4: Iteration: 2000 / 2000 [100%]  (Sampling)</span></span>
<span><span class="co">## Chain 4: </span></span>
<span><span class="co">## Chain 4:  Elapsed Time: 7.171 seconds (Warm-up)</span></span>
<span><span class="co">## Chain 4:                2.834 seconds (Sampling)</span></span>
<span><span class="co">## Chain 4:                10.005 seconds (Total)</span></span>
<span><span class="co">## Chain 4:</span></span></code></pre>
<pre><code><span><span class="co">## Warning: There were 52 divergent transitions after warmup. See</span></span>
<span><span class="co">## https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">## to find out why this is a problem and how to eliminate them.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Examine the pairs() plot to diagnose sampling problems</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span></span>
<span><span class="co">## Running the chains for more iterations may help. See</span></span>
<span><span class="co">## https://mc-stan.org/misc/warnings.html#bulk-ess</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span></span>
<span><span class="co">## Running the chains for more iterations may help. See</span></span>
<span><span class="co">## https://mc-stan.org/misc/warnings.html#tail-ess</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: There were 52 divergent transitions after warmup. Increasing</span></span>
<span><span class="co">## adapt_delta above 0.8 may help. See</span></span>
<span><span class="co">## http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span></code></pre>
<pre><code><span><span class="co">##  Family: gaussian </span></span>
<span><span class="co">##   Links: mu = identity; sigma = identity </span></span>
<span><span class="co">## Formula: y ~ -1 + xlag + ylag + (1 | id) </span></span>
<span><span class="co">##    Data: dat_long (Number of observations: 4000) </span></span>
<span><span class="co">##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">##          total post-warmup draws = 4000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Multilevel Hyperparameters:</span></span>
<span><span class="co">## ~id (Number of levels: 1000) </span></span>
<span><span class="co">##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## sd(Intercept)     0.07      0.05     0.00     0.18 1.01      380      206</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Regression Coefficients:</span></span>
<span><span class="co">##      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## xlag     0.24      0.01     0.21     0.27 1.00     4667     2632</span></span>
<span><span class="co">## ylag     0.97      0.01     0.95     1.00 1.00     1961     2369</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Further Distributional Parameters:</span></span>
<span><span class="co">##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## sigma     1.04      0.01     1.02     1.07 1.00     2439     1444</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS</span></span>
<span><span class="co">## and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">## scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre>
<p>Obviously this is quite a bit different from the true parameter
values. The stability coefficient should be 0.9; the cross-lag should be
0.15. Matters are substantially more problematic when the
contemporaneous effect is present in the DGP. Again, this opens a
colliding path for <span class="math inline">\(y\)</span> biasing the
coefficients.</p>
<p>```{r} dat = simulate_observed_clr(waves = 5, sample.nobs = 1000,
stability.x = 0.90, stability.y = 0.90, contemporaneous.x = 0.5, cross.x
= 0.15, beta.z = 0, beta.u = 0.5, var.y = 1, var.x = 1, cov.xy = 0.5,
cov.uz = 0.5)$data</p>
<p>dat_long = reshape_long_sim_cr(dat) brm(y ~ -1 + xlag + ylag +
(1|id), data = dat_long)</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Christopher Weber:.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
